// ================================================
// HARMONIA WebGL - Floating Particle Aurora
// Theme-aware: gold/maroon particles
// Light mode: very subtle | Dark mode: glowing
// Canvas z-index:-1, pointer-events:none
// ================================================
(function(){
'use strict';
class HarmoniaGL{
constructor(){this.canvas=null;this.ctx=null;this.particles=[];this.N=50;this.t=0;this.dark=false;this.init()}
init(){
this.canvas=document.createElement('canvas');
this.canvas.id='harmonia-webgl-bg';
Object.assign(this.canvas.style,{position:'fixed',top:'0',left:'0',width:'100vw',height:'100vh',zIndex:'-1',pointerEvents:'none',opacity:'0',transition:'opacity 1.5s ease'});
document.body.prepend(this.canvas);
this.ctx=this.canvas.getContext('2d');
if(!this.ctx)return;
this.initParticles();this.resize();this.watchTheme();
requestAnimationFrame(()=>this.canvas.style.opacity='1');
window.addEventListener('resize',()=>this.resize());
this.loop();
}
initParticles(){
const L=[[.835,.659,.325,.04],[.447,.184,.216,.03],[.91,.788,.478,.03]];
const D=[[.941,.784,.431,.12],[.961,.851,.541,.10],[.447,.184,.216,.06]];
for(let i=0;i<this.N;i++){
this.particles.push({
x:Math.random()*2-1,y:Math.random()*2-1,
vx:(Math.random()-.5)*.0004,vy:(Math.random()-.5)*.0003,
sz:Math.random()*3+1.5,
lc:L[Math.floor(Math.random()*L.length)],
dc:D[Math.floor(Math.random()*D.length)],
ph:Math.random()*Math.PI*2,sp:Math.random()*.3+.1
})}}
watchTheme(){
this.dark=document.documentElement.getAttribute('data-theme')==='dark';
new MutationObserver(()=>{
this.dark=document.documentElement.getAttribute('data-theme')==='dark';
}).observe(document.documentElement,{attributes:true})}
resize(){
const d=Math.min(window.devicePixelRatio||1,2);
this.canvas.width=window.innerWidth*d;this.canvas.height=window.innerHeight*d}
loop(){
this.t+=.016;const c=this.ctx,w=this.canvas.width,h=this.canvas.height;
c.clearRect(0,0,w,h);
for(const p of this.particles){
p.x+=p.vx+Math.sin(this.t*p.sp+p.ph)*.00015;
p.y+=p.vy+Math.cos(this.t*p.sp*.7+p.ph)*.00012;
if(p.x>1.1)p.x=-1.1;if(p.x<-1.1)p.x=1.1;
if(p.y>1.1)p.y=-1.1;if(p.y<-1.1)p.y=1.1;
const sm=1+Math.sin(this.t*p.sp*2+p.ph)*.3;
const cl=this.dark?p.dc:p.lc;
const sx=(p.x+1)*.5*w,sy=(p.y+1)*.5*h,sr=p.sz*sm*(this.dark?3:2);
const g=c.createRadialGradient(sx,sy,0,sx,sy,sr);
g.addColorStop(0,`rgba(${cl[0]*255|0},${cl[1]*255|0},${cl[2]*255|0},${cl[3]})`);
g.addColorStop(1,`rgba(${cl[0]*255|0},${cl[1]*255|0},${cl[2]*255|0},0)`);
c.beginPath();c.arc(sx,sy,sr,0,Math.PI*2);c.fillStyle=g;c.fill()}
requestAnimationFrame(()=>this.loop())}
}
if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',()=>new HarmoniaGL());
else new HarmoniaGL();
})();
